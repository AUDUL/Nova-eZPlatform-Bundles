{% set withRegistrations = withRegistrations is defined ? withRegistrations : true %}
{% set withStatus = withStatus is defined ? withStatus : true %}
{% set statusKeys = constant('Novactive\\Bundle\\eZMailingBundle\\Entity\\User::STATUSES') %}
{% set styles = constant('Novactive\\Bundle\\eZMailingBundle\\Entity\\User::STATUSES_STYLE') %}
<table class="table table-striped table-hover table-sm">
    <thead>
    <tr>
        <th class="text-center">ID</th>
        <th>Email</th>
        {% if withStatus %}
            <th>Status</th>
        {% endif %}
        <th class="text-center">Country</th>
        <th class="text-center">Origin</th>
        <th class="text-center">Updated</th>
        <th class="text-center">Created</th>

        {% if withRegistrations %}
            <th class="text-center">Registrations</th>
        {% endif %}
    </tr>
    </thead>
    <tbody>
    {% for item in items %}
        <tr>
            <td class="text-center">{{ item.id }}</td>
            <td><a href="{{ path('novaezmailing_user_show', {user:item.id}) }}" data-toggle="popover"
                   title="{{ item.gender }} {{ item.firstname }} {{ item.lastName }}"
                   data-content="
                        {% if item.birthDate is not empty %}<p><strong>Birth date</strong>: {{ item.birthDate|localizeddate|default('') }}</p>{% endif %}
                        {% if item.phone is not empty %}<p><strong>Phone</strong>: {{ item.phone }}</p>{% endif %}
                        {% if item.zipcode is not empty or item.city is not empty or item.city is not empty or state is not empty %}<p><strong>Location</strong>:{{ item.zipcode }} {{ item.city }} {{ item.state }}</p>{% endif %}
                        {% if item.jobTitle is not empty or item.company is not empty %}<p><strong>Job</strong>: {{ item.jobTitle }} {{ item.company }}</p>{% endif %}
                   "
                   data-html="true"
                   data-trigger="hover"
                >{{ item.email }}</a></td>
            {% if withStatus %}
                <td><span class="badge badge-{{ styles[item.status] }}">{{ statusKeys[item.status] }}</span></td>
            {% endif %}
            <td class="text-center">{{ item.country|country_name }}</td>
            <td class="text-center">{{ item.origin }}</td>
            {% if currentMailingList is defined %}
                {% for registration in item.registrations %}
                    {% if registration.mailingList.id == currentMailingList.id %}
                        <td class="text-center">{{ registration.updated|localizeddate }}</td>
                        <td class="text-center">{{ registration.created|localizeddate }}</td>
                    {% endif %}
                {% endfor %}
            {% else %}
                <td class="text-center">{{ item.updated|localizeddate }}</td>
                <td class="text-center">{{ item.created|localizeddate }}</td>
            {% endif %}
            {% if withRegistrations %}
                <td>
                    <table class="table table-striped table-hover table-sm">
                        <tr>
                            <th class="text-center">Mailing List</th>
                            <th>Updated</th>
                            <th>Created</th>
                        </tr>
                        {% for registration in item.registrations %}
                            <tr>
                                <td>
                                    <a href="{{ path('novaezmailing_mailinglist_show',{mailingList:registration.mailinglist.id}) }}">{{ registration.mailinglist.name }}</a>
                                </td>
                                <td>{{ registration.updated|localizeddate }}</td>
                                <td>{{ registration.created|localizeddate }}</td>
                            </tr>
                        {% endfor %}
                    </table>
                </td>
            {% endif %}
        </tr>
    {% endfor %}
    </tbody>
</table>
